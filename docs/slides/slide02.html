<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>R言語速習</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">R言語速習</h1>
</div>
<div class="talk-subtitle">
    <p>第2講 - データの扱い・可視化・確率シミュレーション</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>
<section>
<section id="slide-org4879e60">
<h2 id="org4879e60">講義概要</h2>
<ul>
<li>データの取り扱い</li>
<li>描画の基礎</li>
<li>確率シミュレーション</li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org208dc0c">
<h2 id="org208dc0c">データフレーム</h2>
<div class="outline-text-2" id="text-org208dc0c">
</div>
</section>
<section id="slide-org12a62f4">
<h3 id="org12a62f4">データ構造</h3>
<ul>
<li>Rに用意されている基本的なデータ構造
<ul>
<li>ベクトル (vector) : 1次元配列</li>
<li>行列 (matrix) : 2次元配列</li>
<li>配列 (array) : 多次元配列</li>
<li><b>データフレーム</b> (data frame) : 表 (2次元配列)</li>

</ul></li>
<li>特殊なもの
<ul>
<li>リスト (list) : オブジェクトの集合</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org64aa34b">
<h3 id="org64aa34b">データフレーム</h3>
<ul>
<li>複数の個体について，いくつかの属性を集計した表
<ul>
<li>長さの等しい列ベクトルをまとめたもの</li>
<li>各列のデータ型はバラバラでも良い</li>

</ul></li>
<li>実データの最も一般的な形式</li>
<li><p>
<span style="color:green;">データフレームの例</span>
</p>
<blockquote>
<p>
ある小学校の1年生の身長・体重・性別・血液型のデータ
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">名前</th>
<th scope="col" class="org-right">身長 [cm]</th>
<th scope="col" class="org-right">体重 [kg]</th>
<th scope="col" class="org-left">性別</th>
<th scope="col" class="org-left">血液型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">太郎</td>
<td class="org-right">108</td>
<td class="org-right">19</td>
<td class="org-left">男</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-left">花子</td>
<td class="org-right">116</td>
<td class="org-right">21</td>
<td class="org-left">女</td>
<td class="org-left">O</td>
</tr>

<tr>
<td class="org-left">次郎</td>
<td class="org-right">130</td>
<td class="org-right">25</td>
<td class="org-left">男</td>
<td class="org-left">AB</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-right">&#x2026;</td>
<td class="org-right">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>
</tbody>
</table>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc37b145">
<h3 id="orgc37b145">&ldquo;base R&rdquo; vs &ldquo;tidyverse&rdquo;</h3>
<ul>
<li>データ操作とグラフィクスの枠組
<ul>
<li><b>base R</b> : R の標準環境</li>
<li><b>tidyverse</b> : Hadley Wickham @RStudio による拡張パッケージ集
<ul>
<li><a href="https://www.tidyverse.org/packages/">https://www.tidyverse.org/packages/</a></li>
<li><a href="https://tidyverse.tidyverse.org/">https://tidyverse.tidyverse.org/</a></li>

</ul></li>

</ul></li>
<li>本講義では tidyverse を中心に説明</li>
<li><p>
パッケージ集の利用には以下が必要
</p>
<div class="org-src-container">

<pre><code class="R" >#' 最初に一度だけ以下のいずれかを実行しておく
#'  - Package タブから tidyverse をインストール
#'  - コンソール上で次のコマンドを実行 'install.packages("tidyverse")'
#' tidyverse パッケージの読み込み
library(tidyverse)
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org89e39aa">
<h3 id="org89e39aa">データフレームの作成</h3>
<ul>
<li>作成方法はいくつか用意されている
<ul>
<li>同じ長さのベクトルを並べる(関数 <code>tibble::tibble()</code>)</li>
<li>データフレームを結合する(関数 <code>dplyr::bind_cols()</code>)</li>
<li>マトリクスを変換する (全て同じ型の場合)</li>
<li>ファイルを読み込む (CSV形式を主に扱う)</li>

</ul></li>
<li><p>
<span style="color:green;">データフレームの作成の例</span>
</p>
<div class="org-src-container">

<pre><code class="R" >#' 同じ長さのベクトルを並べる (関数 tibble::tible())
#' (... &lt;- ...) は代入した結果を表示
(foo &lt;- tibble(one = c(1,2,3),two = c("AB","CD","EF"))) 
(bar &lt;- tibble(three = c("x","y","z"),four = c(0.9,0.5,-0.3)))
#' データフレームを結合する (関数 dplyr::bind_cols())
(baz &lt;- bind_cols(foo,bar)) # bind columns
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgac40c25" data-background="#fef4f4">
<h3 id="orgac40c25">練習問題</h3>
<ul>
<li><p>
次の表に対応するデータフレームを作成しなさい
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">math</th>
<th scope="col" class="org-right">phys</th>
<th scope="col" class="org-right">chem</th>
<th scope="col" class="org-right">bio</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-right">90</td>
<td class="org-right">25</td>
<td class="org-right">65</td>
<td class="org-right">70</td>
</tr>

<tr>
<td class="org-left">B</td>
<td class="org-right">80</td>
<td class="org-right">50</td>
<td class="org-right">100</td>
<td class="org-right">50</td>
</tr>

<tr>
<td class="org-left">C</td>
<td class="org-right">70</td>
<td class="org-right">75</td>
<td class="org-right">70</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">D</td>
<td class="org-right">60</td>
<td class="org-right">100</td>
<td class="org-right">40</td>
<td class="org-right">80</td>
</tr>

<tr>
<td class="org-left">E</td>
<td class="org-right">50</td>
<td class="org-right">80</td>
<td class="org-right">75</td>
<td class="org-right">100</td>
</tr>
</tbody>
</table></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orge88d105">
<h2 id="orge88d105">ファイルの操作</h2>
<div class="outline-text-2" id="text-orge88d105">
</div>
</section>
<section id="slide-orgac6f200">
<h3 id="orgac6f200">ファイルを用いたデータの読み書き</h3>
<ul>
<li>解析においてはデータファイルの操作が必要
<ul>
<li>整理したデータを保存する</li>
<li>収集されたデータを読み込む</li>

</ul></li>
<li>Rで利用可能なデータファイル
<ul>
<li>CSV 形式 (comma separated values) : テキストファイル</li>
<li>RData 形式 : Rの内部表現を用いたバイナリーファイル</li>
<li>Excel 形式 : Microsoft Excel ファイル (Filesタブから読み込み)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge19557f">
<h3 id="orge19557f">作業ディレクトリ</h3>
<ul>
<li>作業ディレクトリとファイルに関する注意
<ul>
<li>Rの処理は特定のフォルダ(<b>作業ディレクトリ</b>)内で実行される</li>
<li>ファイルは作業ディレクトリにあるものとして扱われる</li>
<li>作業ディレクトリ以外のファイルを扱う場合はパスを含めて指定する必要がある</li>

</ul></li>
<li>作業ディレクトリに関する操作
<ul>
<li>確認の仕方 : コンソールの上部の表示</li>
<li>変更の仕方 : 主に <b>Session</b> メニューを利用</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org3fd6734">
<h3 id="org3fd6734">CSV ファイルの操作</h3>
<ul>
<li><p>
関数 <code>readr::write_csv()</code> : ファイルの書き出し
</p>
<div class="org-src-container">

<pre><code class="R" >write_csv(x, file = "ファイル名") # データフレームxをファイルに書き出す
</code></pre>
</div></li>
<li><p>
関数 <code>readr::read_csv()</code> : ファイルの読み込み
</p>
<div class="org-src-container">

<pre><code class="R" >y &lt;- read_csv(file = "ファイル名") # 変数yにCSVファイルの内容を読み込む
</code></pre>
</div></li>
<li>Rの標準関数 base::data.frame() とは行名の扱いに違いがあるので注意</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf6efc88" data-background="#fef4f4">
<h3 id="orgf6efc88">練習問題</h3>
<ul>
<li>前の演習で作成したデータフレームを適当なファイルに書き出しなさい</li>
<li>書き出したファイルから別の変数に読み込みなさい</li>
<li><code>pcr_case_daily.csv</code> (厚労省からダウンロードしたファイル)を
変数 <code>pcr_data</code> に読み込みなさい</li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org3cfb85b">
<h2 id="org3cfb85b">データフレームの操作</h2>
<div class="outline-text-2" id="text-org3cfb85b">
</div>
</section>
<section id="slide-org13cd6c7">
<h3 id="org13cd6c7">要素の選択</h3>
<ul>
<li>選択方法はいくつか用意されている
<ul>
<li>添字の番号を指定する (マイナスは除外)</li>
<li>論理値 (TRUE/FALSE) で指定する</li>
<li>要素の名前で指定する</li>

</ul></li>
<li><p>
<span style="color:green;">データフレームの要素の選択</span>
</p>
<div class="org-src-container">

<pre><code class="R" >z &lt;- tibble(one = c(1,2,3),
                two = c("AB","CD","EF"),
                three = 6:8)
z[1,2] # 1行2列の要素を選択
z[-c(1,3),] # 1,3行を除外
z[c(TRUE,FALSE,TRUE),] # 1,3行を選択
z[,"two"] # 列名"two"を選択(1列のデータフレームになる)
z["two"]  # 上記と同様の結果
z[,c("one","three")] # 列名"one"と"three"を選択(データフレームになる)
z[c("one","three")]  # 上記と同様の結果
z[["two"]] # 列名"two"のベクトルを選択(1列の場合しか使えない)
z$two      # 上記と同様の結果
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orga21c245">
<h3 id="orga21c245">部分集合(行)の選択</h3>
<ul>
<li><p>
関数 <code>dplyr::filter()</code> : 条件を指定して行を選択
</p>
<div class="org-src-container">

<pre><code class="R" >filter(.data, ..., .by = NULL, .preserve = FALSE)
#' .data: データフレーム 
#' ...: 行に関する条件
#' .by: グループ化を指定(実験的な実装)
#' .preserve: グループ化を維持するか指定(実験的な実装)
#' 詳細は"?dplyr::filter"を参照
</code></pre>
</div></li>
<li>行に関する条件指定には以下を用いることができる
<ul>
<li>等号 : <code>==</code> (否定は <code>!=</code>)</li>
<li>不等号 : <code>&lt;,&gt;,&lt;=,&gt;=</code></li>
<li>論理式 : <code>&amp;</code> (かつ), <code>|</code> (または)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org75d708a">
<h3 id="org75d708a">部分集合(列)の選択</h3>
<ul>
<li><p>
関数 <code>dplyr::select()</code> : 条件を指定して列を選択
</p>
<div class="org-src-container">

<pre><code class="R" >select(.data, ...)
#' .data: データフレーム 
#' ...: 列に関する条件(列の番号，名前，名前に関する条件式を利用する)
#' 詳細は"?dplyr::select"を参照
</code></pre>
</div></li>
<li>条件指定には例えば以下のような方法がある
<ul>
<li>含めない : <code>!列名</code>, <code>!c(列名,列名,...)</code>, <code>!(列名:列名)</code></li>
<li>特定の文字列で始まる : <code>starts_with("文字列")</code></li>
<li>特定の文字列で終わる : <code>ends_with("文字列")</code>,</li>
<li>組み合わせ : <code>&amp;</code> (かつ), <code>|</code> (または)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org9065f2d">
<h3 id="org9065f2d">パイプ演算子</h3>
<ul>
<li>処理を順次結合する演算子 (いくつか定義がある)
<ul>
<li><code>|&gt;</code> (base R で定義; この講義ではこちらで記述する)</li>
<li><code>%&gt;%</code> (<code>package::magrittr</code>)</li>

</ul></li>
<li><p>
<span style="color:green;">データフレームの部分集合の取得</span>
</p>
<div class="org-src-container">

<pre><code class="R" >#' 前に作成したデータフレーム z を用いた例
(foo &lt;- filter(z, three &gt;= 7)) # 列 three の値が7以上の行を選択
(bar &lt;- select(foo, c(one, three))) # 列 one,three を選択
#' パイプを用いると以下のように書ける
z |&gt; filter(three &gt;= 7) |&gt; select(one, three)
#' 別の例
z |&gt; 
  filter(one != 2) |&gt;        # 列 one の値が2でない行を選択
  select(starts_with("t")) # 列 "t"wo,"t"hree を選択
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org0ea4ef0" data-background="#fef4f4">
<h3 id="org0ea4ef0">練習問題</h3>
<ul>
<li><code>pcr_case_daily.csv</code> から以下の条件を満たすデータを取り出しなさい
<ul>
<li>医療機関 (<code>f</code>) での検査件数が2000を越えたときの
国立感染症研究所 (<code>a</code>) と医療機関 (<code>f</code>) のデータ</li>
<li>大学等 (<code>e</code>) と医療機関 (<code>f</code>) でともに検査件数が2000を越えたデータ</li>
<li>2020年3月の各機関(<code>g,i</code> は集計なので除く)の検査件数データ</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org9901e51">
<h2 id="org9901e51">データフレームの集約</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge8958b5">
<h3 id="orge8958b5">統計量の計算</h3>
<ul>
<li>データを集約した値 = 統計量
<ul>
<li>関数 <code>sum()</code> : 総和を計算する</li>
<li>関数 <code>mean()</code> : 平均</li>
<li>関数 <code>max()</code> : 最大値</li>
<li>関数 <code>min()</code> : 最小値</li>
<li>関数 <code>median()</code> : 中央値</li>
<li>関数 <code>quantile()</code> : 分位点</li>

</ul></li>
<li>これ以外にも沢山あるので調べてみよう</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org5a14caf">
<h3 id="org5a14caf">列ごとの集約</h3>
<ul>
<li><p>
関数 <code>dplyr::summarise()</code> : 行ごとに計算する
</p>
<div class="org-src-container">

<pre><code class="R" >summarise(.data, ..., .by = NULL, .groups = NULL)
#' .data: データフレーム
#' ...: 求めたい統計量を計算するための処理を記述
#' .by: グループ化を指定(実験的な実装)
#' .groups: グループ化の結果を指定(実験的な実装)
</code></pre>
</div></li>
<li><p>
<span style="color:green;">平均の算出</span>
</p>
<div class="org-src-container">

<pre><code class="R" >#' 練習問題のデータフレームを用いた例
grade_data |&gt;
  summarise(math_mean = mean(math), nums = n()) # 数学の平均を求める
grade_data |&gt;
  summarise(across(!name, mean)) # 名前の列以外の平均を求める
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org2f74b02">
<h3 id="org2f74b02">グループごとの操作</h3>
<ul>
<li><p>
関数 <code>dplyr::group_by()</code> : グループ化を行う
</p>
<div class="org-src-container">

<pre><code class="R" >group_by(.data, ..., .add = FALSE, .drop = group_by_drop_default(.data))
#' .data: データフレーム
#' ...: グループ化を行う項目を含む列や条件を記述
#' .add: グループ化の上書きを制御(既定値FALSEは上書き)
#' .drop: グループ化に関与しない因子の扱い方
</code></pre>
</div></li>
<li><p>
<span style="color:green;">グループごとに集計</span>
</p>
<div class="org-src-container">

<pre><code class="R" >#' pcr_data を用いた例
#' 医療機関 (~f~) のPCR件数を各月で集計する
#' 日付の扱いに関数 lubridate::year(), lubridate::month() を利用
pcr_data |&gt;
  group_by(year(date), month(date)) |&gt; # 年と月でグループ化する
  summarise(total_nums = sum(f))         # f の合計値を計算する
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc12831e" data-background="#fef4f4">
<h3 id="orgc12831e">練習問題</h3>
<ul>
<li><code>pcr_case_daily.csv</code> を集計しなさい
<ul>
<li>各機関でのPCR検査件数の最大値</li>
<li>2021年の各機関でのPCR検査件数の月ごとの最大値</li>

</ul></li>
<li><code>datasets::mtcars</code> を集計しなさい
<ul>
<li>気筒数 (<code>cyl</code>) ごとに排気量 (<code>disp</code>) の最大値，最小値</li>
<li>気筒数 (<code>cyl</code>) とギア数 (<code>gear</code>) ごとの燃費 (<code>mpg</code>) の平均値</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org4eb60e5">
<h2 id="org4eb60e5">参考</h2>
<div class="outline-text-2" id="text-org4eb60e5">
</div>
</section>
<section id="slide-orga4ba313">
<h3 id="orga4ba313">その他の資料</h3>
<ul>
<li>詳細なデータの取り扱いについては以下を参照
<ul>
<li>講義ノート
<ul>
<li>R言語の基礎 第3章 (pp29-52)</li>

</ul></li>
<li>統計データ解析I スライド (base R での記述)
<ul>
<li>第1講 Rの基本的な操作</li>
<li>第3講 データの整理と集計</li>

</ul></li>

</ul></li>
<li>RStudio 製の cheat sheet 集
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/">https://rstudio.github.io/cheatsheets/</a>
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/html/rstudio-ide.html">rstudio</a> <a href="https://rstudio.github.io/cheatsheets/rstudio-ide.pdf">cheatsheet</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-import.html">readr</a> <a href="https://rstudio.github.io/cheatsheets/data-import.pdf">cheatsheet</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-transformation.html">dplyr</a> <a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf">cheatsheet</a></li>

</ul></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgdb0b4f6">
<h2 id="orgdb0b4f6">描画の基礎</h2>
<div class="outline-text-2" id="text-orgdb0b4f6">
</div>
</section>
<section id="slide-org9554f8d">
<h3 id="org9554f8d">データの可視化</h3>
<ul>
<li>データ全体の特徴や傾向を把握するための直感的で効果的な方法</li>
<li>R言語には極めて多彩な作図機能が用意されている
<ul>
<li><b>base R</b> : <code>package::graphics</code> (標準で読み込まれる)</li>
<li><b>tidyverse</b> : <code>package::ggplot2</code></li>

</ul></li>
<li>描画関連の関数は色，
線種や線の太さ，
図中の文字の大きさなどを指定することができる</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org1b250cd">
<h3 id="org1b250cd">描画の初期化</h3>
<ul>
<li><p>
<code>package::ggplot2</code> ではさまざまな作図関数を追加しながら描画する
</p>
<div class="org-src-container">

<pre><code class="R" >初期化のための関数 + 
  作図のための関数 + ... +
  装飾のための関数 + ... # 関数が生成するオブジェクトに変更分を随時追加する
</code></pre>
</div></li>
<li><p>
関数 <code>ggplot2::ggplot()</code> : 初期化
</p>
<div class="org-src-container">

<pre><code class="R" >ggplot(data = NULL, mapping = aes(), ..., environment = parent.frame())
#' data: データフレーム
#' mapping: 描画の基本となる"審美的マップ"(xy軸，色，形，塗り潰しなど)の設定
#' environment: 互換性のための変数(廃止)
#' 詳細は"?ggplot2::ggplot"を参照
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgfcfc7c1">
<h3 id="orgfcfc7c1">基本的な描画 (折線グラフ)</h3>
<ul>
<li><p>
関数 <code>ggplot2::geom_line()</code> : 線の描画
</p>
<div class="org-src-container">

<pre><code class="R" >geom_line(
  mapping = NULL,
  data = NULL,
  stat = "identity",
  position = "identity",
  ...,
  na.rm = FALSE, orientation = NA, show.legend = NA, inherit.aes = TRUE
)
#' mapping: "審美的"マップの設定
#' data: データフレーム
#' stat: 統計的な処理の指定
#' position: 描画位置の調整
#' ...: その他の描画オプション
#' na.rm: NA(欠損値)の削除(既定値は削除しない)
#' show.legend: 凡例の表示(既定値は表示)
#' 詳細は"?ggplot2::geom_line"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">民間検査会社と医療機関の検査件数の推移</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt; # パイプ演算子でデータフレームを関数 ggplot2::ggplot() に渡す
  ggplot(aes(x = date)) + # date をx軸に指定
  geom_line(aes(y = d), colour = "blue") + # 民間検査会社を青
  geom_line(aes(y = f), colour = "red") +  # 医療機関を赤
  labs(y = "number of tests") # y軸のラベルを変更
</code></pre>
</div>


<div id="org2814e67" class="figure">
<p><img src="figs/02-geomline-geomline.png" alt="02-geomline-geomline.png" width="50%" />
</p>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">全ての機関の検査件数の推移</span> 
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt; select(-c(g,i)) |&gt; # 集計値を除く
  pivot_longer(!date, names_to = "organ", values_to = "nums") |&gt; 
  ggplot(aes(x = date, y = nums, colour = organ)) + geom_line() +
  labs(title = "PCR Tests in Various Organizatios",
       x = "Date", y = "Number of Tests") # xy軸のラベルを変更
</code></pre>
</div>


<div id="org80d3265" class="figure">
<p><img src="figs/02-geomline.png" alt="02-geomline.png" width="50%" />
</p>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">別の形式での描画</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt; select(-c(g,i)) |&gt; 
  pivot_longer(!date, names_to = "organ", values_to = "nums") |&gt; 
  ggplot(aes(x = date, y = nums, colour = organ)) +
  labs(title = "PCR Tests in Various Organizatios", x = "Date", y = "Number of Tests") +
  geom_line(show.legend  =  FALSE) + # 凡例を消す
  facet_grid(vars(organ)) # "organ" ごとに異なる図を並べる
</code></pre>
</div>


<div id="org5808e31" class="figure">
<p><img src="figs/02-geomline-facetgrid.png" alt="02-geomline-facetgrid.png" width="50%" />
</p>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgfe9bdd7">
<h3 id="orgfe9bdd7">基本的な描画 (散布図)</h3>
<ul>
<li><p>
関数 <code>ggplot2::geom_point()</code> : 点の描画
</p>
<div class="org-src-container">

<pre><code class="R" >geom_point(
  mapping = NULL,
  data = NULL,
  stat = "identity",
  position = "identity",
  ...,
  na.rm = FALSE, show.legend = NA, inherit.aes = TRUE
)
#' mapping: 審美的マップの設定
#' data: データフレーム
#' stat: 統計的な処理の指定
#' position: 描画位置の調整
#' ...: その他の描画オプション
#' na.rm: NA(欠損値)の削除(既定値は削除しない)
#' show.legend: 凡例の表示(既定値は表示)
#' 詳細は"?ggplot2::geom_point"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">国立感染症研究所と医療機関の検査件数の関係</span>
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"] == "Darwin") { # MacOSか調べて日本語フォントを指定
  theme_update(text = element_text(family = "HiraginoSans-W4"))}
pcr_data |&gt; 
  ggplot(aes(x = a, y = f)) + # x軸を a，y軸を f に設定
  geom_point(colour = "blue", shape = 19) + # 色と形を指定(点の形は"?points"を参照)
  labs(x = pcr_names["a"], y = pcr_names["f"]) # 軸の名前を指定
</code></pre>
</div>


<div id="org3c23296" class="figure">
<p><img src="figs/02-geompoint.png" alt="02-geompoint.png" width="50%" />
</p>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">各軸を対数表示</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt; 
  ggplot(aes(x = a, y = f)) + # x軸を a，y軸を f に設定
  geom_point(colour = "blue", shape = 19) + # 色と形を指定
  scale_x_log10() + scale_y_log10() + # 各軸を対数で表示
  labs(x = pcr_names["a"], y = pcr_names["f"]) # 軸の名前を指定
</code></pre>
</div>


<div id="org9c18aaf" class="figure">
<p><img src="figs/02-geompoint-scalelog.png" alt="02-geompoint-scalelog.png" width="50%" />
</p>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org365d547">
<h3 id="org365d547">基本的な描画 (散布図行列)</h3>
<ul>
<li>散布図行列は複数の散布図を行列状に配置したもの</li>
<li><p>
関数 GGally::ggpairs() : 散布図行列の描画
</p>
<div class="org-src-container">

<pre><code class="R" >#' install.packages("GGally") # パッケージのインストール(必要な場合)
library(GGally) # パッケージのロード
ggpairs(
  data, mapping = NULL,
  columns = 1:ncol(data),
  upper = list(continuous = "cor", combo = "box_no_facet", discrete = "count", na = "na"),
  lower = list(continuous = "points", combo = "facethist", discrete = "facetbar", na = "na"),
  diag = list(continuous = "densityDiag", discrete = "barDiag", na = "naDiag"),
  ...,
  axisLabels = c("show", "internal", "none"),
  columnLabels = colnames(data[columns]),
  legend = NULL
)
#' columns: 表示するデータフレームの列を指定
#' upper/lower/diag: 行列の上三角・下三角・対角の表示内容を設定
#' axisLabels: 各グラフの軸名の扱い方を指定
#' columnLabels: 表示する列のラベルを設定(既定値はデータフレームの列名)
#' legend: 凡例の設定(どの成分を使うか指定)
#' 詳細は"?GGally::ggpairs"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">各検査機関での検査件数の関係を視覚化</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt;
  select(!c(date,g,i)) |&gt; # 日付と集計値を除いて必要なデータフレームに整形
  ggpairs() # 標準の散布図行列
</code></pre>
</div>


<div id="org5018496" class="figure">
<p><img src="figs/02-ggpairs.png" alt="02-ggpairs.png" width="50%" />
</p>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">日付の情報を付加</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt; select(-c(g,i)) |&gt; # 日付から四半期の因子を作成
  mutate(quarter = as_factor(quarter(date, with_year = TRUE))) |&gt;
  ggpairs(columns = 2:8, columnLabels = pcr_names[-c(1,8,10)], axisLabels = "none",
          aes(colour = quarter), legend = c(2,1), # 四半期ごとに色づけて(1,1)の凡例を使用
          upper = "blank", diag = list(continuous = "barDiag")) +
  theme(legend.position = "top") # 凡例を上に表示
</code></pre>
</div>


<div id="org2fda001" class="figure">
<p><img src="figs/02-ggpairs-quarter.png" alt="02-ggpairs-quarter.png" width="50%" />
</p>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgfb42d75">
<h3 id="orgfb42d75">図の保存</h3>
<ul>
<li>RStudioの機能を使う (少数の場合はこちらが簡便)
<ul>
<li>右下ペイン <b>Plots</b> タブから <b>Export</b> をクリック</li>
<li>形式やサイズを指定する</li>
<li>クリップボードにコピーもできる</li>

</ul></li>
<li><p>
関数 <code>ggsave()</code> : 図の保存
</p>
<div class="org-src-container">

<pre><code class="R" >ggsave(
  filename,
  plot = last_plot(),
  device = NULL,
  path = NULL, scale = 1, width = NA, height = NA,
  units = c("in", "cm", "mm", "px"), dpi = 300, limitsize = TRUE, bg = NULL,
  ...
)
#' filename: ファイル名
#' plot: 保存する描画オブジェクト
#' device: 保存する形式("pdf","jpeg","png"など)
#' 詳細は"?ggplot2::ggsave"を参照
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org44c0918" data-background="#fef4f4">
<h3 id="org44c0918">練習問題</h3>
<ul>
<li><code>pcr_case_daily.csv</code> を用いて以下の描画を行いなさい
<ul>
<li>検疫所 (<code>b</code>)，地方衛生研究所.保健所 (<code>c</code>)，民間検査会社 (<code>d</code>) における
検査件数の推移</li>
<li>民間検査会社 (<code>d</code>)，大学等 (<code>e</code>)，医療機関 (<code>f</code>) での
検査件数の関係 (散布図)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgfb5c96f">
<h2 id="orgfb5c96f">さまざまなグラフ</h2>
<div class="outline-text-2" id="text-orgfb5c96f">
</div>
</section>
<section id="slide-orgceaad25">
<h3 id="orgceaad25">ヒストグラム</h3>
<ul>
<li><p>
データの値の範囲をいくつかの区間に分割し，
各区間に含まれるデータの個数を棒グラフにした図
</p>
<ul>
<li>棒グラフの幅が区間, 面積が区間に含まれるデータの個数に比例するようにグラフを作成</li>
<li>データ分布の可視化に有効(値の集中とばらつきを調べる)</li>

</ul>
<div class="org-src-container">

<pre><code class="R" >geom_histogram(
  mapping = NULL, data = NULL, stat = "bin", position = "stack",
  ...,
  binwidth = NULL,
  bins = NULL,
  na.rm = FALSE, orientation = NA, show.legend = NA, inherit.aes = TRUE
)
#' binwidth: ヒストグラムのビンの幅を指定
#' bins: ヒストグラムのビンの数を指定
#' 詳細は"?ggplot2::geom_histogram"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">民間検査会社での検査件数の分布</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt;
  ggplot(aes(x = d)) + # 分布を描画する列を指定
  geom_histogram(bins = 30, fill = "lightblue", colour = "blue") +
  labs(x = pcr_names["d"], y = "頻度", title = "検査件数のヒストグラム")
</code></pre>
</div>


<div id="org1adc808" class="figure">
<p><img src="figs/02-geomhistogram.png" alt="02-geomhistogram.png" width="50%" />
</p>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge940640">
<h3 id="orge940640">箱ひげ図</h3>
<ul>
<li><p>
データ散らばり具合を考察するための図
</p>
<ul>
<li>長方形の辺は四分位点(下端が第1，中央が第2，上端が第3)</li>
<li>中央値から第1四分位点・第3四分位点までの1.5倍以内にあるデータの
最小の値・最大の値を下端・上端とする線(ひげ)</li>
<li>ひげの外側の点は外れ値</li>

</ul>

<div class="org-src-container">

<pre><code class="R" >geom_boxplot(
  mapping = NULL, data = NULL, stat = "boxplot", position = "dodge2",
  ...,
  outlier.colour = NULL, outlier.color = NULL, outlier.fill = NULL,
  outlier.shape = 19, outlier.size = 1.5, outlier.stroke = 0.5, outlier.alpha = NULL,
  notch = FALSE, notchwidth = 0.5, varwidth = FALSE,
  na.rm = FALSE, orientation = NA, show.legend = NA, inherit.aes = TRUE
)
#' ourlier.*: 外れ値の描画方法の指定
#' notch*: ボックスの切れ込みの設定
#' varwidth: ボックスの幅でデータ数を表示
#' 詳細は"?ggplot2::geom_boxplot"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">月ごとの大学等での検査件数の分布(分位点)</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt;
  filter(year(date) == 2021) |&gt; # 2021年を抽出
  mutate(date = as_factor(month(date))) |&gt; # 月を因子化する
  ggplot(aes(x = date, y = e)) + # 月毎に集計する
  geom_boxplot(fill = "orange") + # 塗り潰しの色を指定
  labs(title = "月ごとの検査件数 (2021年)", x = "月", y = pcr_names["e"])
</code></pre>
</div>


<div id="org22bd71c" class="figure">
<p><img src="figs/02-geomboxplot.png" alt="02-geomboxplot.png" width="50%" />
</p>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgeeeb08e">
<h3 id="orgeeeb08e">棒グラフ</h3>
<ul>
<li><p>
項目ごとの量を並べて表示した図
</p>
<ul>
<li>並べ方はいくつか用意されている
<ul>
<li>積み上げ (stack)</li>
<li>横並び (dodge)</li>
<li>比率の表示 (fill)</li>

</ul></li>

</ul>
<div class="org-src-container">

<pre><code class="R" >geom_bar(
  mapping = NULL, data = NULL, stat = "count", position = "stack",
  ...,
  just = 0.5,
  width = NULL,
  na.rm = FALSE, orientation = NA, show.legend = NA, inherit.aes = TRUE
)
#' just: 目盛と棒の位置の調整(既定値は真中)
#' width: 棒の幅の調整(既定値は目盛の間隔の90%)
#' 詳細は"?ggplot2::geom_bar"を参照
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
<span style="color:green;">機関(医療機関まで)ごとの月の検査件数の推移</span>
</p>
<div class="org-src-container">

<pre><code class="R" >pcr_data |&gt;
  filter(year(date) == 2021) |&gt;
  mutate(month = as_factor(month(date))) |&gt; # 月を作成
  select(-c(date,g,i)) |&gt; # 機関に限定
  group_by(month) |&gt; # 月でグループ化
  summarize(across(everything(), sum)) |&gt; # 全て(月以外)を集計
  pivot_longer(!month, names_to = "organ", values_to = "nums") |&gt; 
  ggplot(aes(x = organ, y = nums, fill = month)) +
  geom_bar(stat = "identity", position = "dodge", na.rm = TRUE) +
  theme(legend.position = "top") + guides(fill = guide_legend(nrow = 1))
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orgf7798ac" class="figure">
<p><img src="figs/02-geombar.png" alt="02-geombar.png" width="50%" />
</p>
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org9f5b66e" data-background="#fef4f4">
<h3 id="org9f5b66e">練習問題</h3>
<ul>
<li>適当なデータに対してグラフの作成を行ってみよう
<ul>
<li>PCR検査件数データ (<code>pcr_case_daily.csv</code>)</li>
<li>東京都の気候データ (<code>tokyo_weather.csv</code>)</li>
<li>R言語に用意されているデータ (関数 <code>data()</code> で一覧表示)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgb67f673">
<h2 id="orgb67f673">参考</h2>
<div class="outline-text-2" id="text-orgb67f673">
</div>
</section>
<section id="slide-org94eb864">
<h3 id="org94eb864">その他の資料</h3>
<ul>
<li>より詳細なグラフの描画については以下を参照して下さい
<ul>
<li>講義ノート
<ul>
<li>R言語の基礎 第4章 (pp53-70)</li>

</ul></li>
<li>統計データ解析I スライド 
<ul>
<li>第4講 データの可視化</li>

</ul></li>

</ul></li>
<li>RStudio 製の cheat sheet 集
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/">https://rstudio.github.io/cheatsheets/</a>
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html">ggplot2</a> <a href="https://rstudio.github.io/cheatsheets/data-visualization.pdf">cheatsheet</a></li>

</ul></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgba2c379">
<h2 id="orgba2c379">疑似乱数</h2>
<div class="outline-text-2" id="text-orgba2c379">
</div>
</section>
<section id="slide-orgfcf62d0">
<h3 id="orgfcf62d0">疑似乱数とは</h3>
<ul>
<li>コンピューターで生成された数列のこと</li>
<li>完全にランダムに数字を発生されることは不可能</li>
<li>Rの既定値は &ldquo;Mersenne-Twister法&rdquo; (<code>?Random</code> 参照)</li>
<li>数値シミュレーションにおいて再現性が要請される場合には，
乱数の &ldquo;シード値&rdquo; を指定して再現性を担保 (関数 <code>set.seed()</code>)</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org64de4da">
<h3 id="org64de4da">基本的な乱数</h3>
<ul>
<li><b>ランダムサンプリング</b> : 与えられた集合の要素を無作為抽出することで発生する乱数</li>
<li><b>二項乱数</b> : 「確率 \(p\) で表がでるコインを \(n\) 回投げた際の表が出る回数」に対応する乱数</li>
<li><b>一様乱数</b> : 決まった区間 \((a, b)\) からランダムに発生する乱数</li>
<li><b>正規乱数</b> : 平均 \(\mu\), 分散 \(\sigma^2\) の正規分布に従う乱数</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgecf83e5">
<h3 id="orgecf83e5">乱数を生成する関数</h3>
<ul>
<li>関数 <code>sample()</code> : ランダムサンプリング</li>
<li>関数 <code>rbinom()</code> : 二項乱数</li>
<li>関数 <code>runif()</code> : 一様乱数</li>
<li>関数 <code>rnorm()</code> : 正規乱数</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge768cef" data-background="#fef4f4">
<h3 id="orge768cef">練習問題</h3>
<ul>
<li>ヘルプを用いて以下の関数を調べよ
<ul>
<li>関数 <code>sample()</code></li>
<li>関数 <code>rbinom()</code></li>
<li>関数 <code>runif()</code></li>
<li>関数 <code>rnorm()</code></li>
<li>関数 <code>set.seed()</code></li>

</ul></li>
<li>以下の試行を実装してみよ
<ul>
<li>サイコロを10回振る</li>
<li>4枚のコインを投げたときの表の枚数</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org5f6efae">
<h2 id="org5f6efae">モンテカルロ法</h2>
<div class="outline-text-2" id="text-org5f6efae">
</div>
</section>
<section id="slide-orgbc7b3c0">
<h3 id="orgbc7b3c0">モンテカルロ法とは</h3>
<ul>
<li>乱数を使った統計実験</li>
<li>計算機上でランダムネスを実現 (擬似乱数)</li>
<li>ランダムネスから導かれる種々の数学的結果を観察</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgaf73c82">
<h3 id="orgaf73c82">例 : 中心極限定理</h3>
<ul>
<li><p>
定理
</p>
<blockquote>
<p>
\(X_1,X_2,\dotsc\) を独立同分布な確率変数列とし，
その平均を \(\mu\) ，標準偏差を \(\sigma\) とする．
このとき，すべての実数 \(a< b\) に対して
</p>
<div>
\begin{equation}
  P\Bigl(a\leq\frac{\sqrt{n}(\bar{X}_n-\mu)}{\sigma}\leq b \Bigr)
  \to\frac{1}{\sqrt{2\pi}}\int_a^be^{-\frac{x^2}{2}}dx\quad
  (n\to\infty)
\end{equation}

</div>
<p>
が成り立つ．
</p>
</blockquote></li>
<li>直感的には &ldquo;多数の独立な確率変数の和はほぼ正規分布に従う&rdquo; ことを主張している</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
確率シミュレーション
</p>
<div class="org-src-container">

<pre><code class="R" >#' 確率変数の分布の設定 (例 : 区間[-1,1]の一様乱数)
my_rand &lt;- function(n) { # n個の乱数を生成
  return(runif(n,min = -1,max = 1))
}
#' 標本平均の計算
my_mean &lt;- function(n) { # n個のデータで計算
  return(mean(my_rand(n)))
}
#' Monte-Carlo実験
set.seed(123) # 実験を再現したい場合はシード値を指定する
mu &lt;- 0; sigma &lt;- sqrt(1/3) # 理論平均と標準偏差
mc &lt;- 5000 # 実験の繰り返し回数
for(n in c(1,2,4,8,16)){ # nを変えて実験
  p &lt;- tibble(x = replicate(mc, my_mean(n))) |&gt; # mc回実験し標本平均を記録
    ggplot(aes(x)) + 
    geom_histogram(aes(y = after_stat(density)), # 密度表示
                   fill = "orchid", alpha = 0.5, # 塗り潰しの色
                   colour = "purple") + # 境界線の色
    geom_function(fun = \(x) dnorm(x, mean = mu, sd = sigma/sqrt(n)),
                  colour = "orange", linewidth = 1.5) + # 理論曲線を重ねる
    labs(x = expression(bar(X)), # x軸の表示
         title = paste0("n=",n)) # タイトルにnを記載
  print(p) # for 文の中では明示的に print する必要がある
}
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org2b3dd4f">
<h3 id="org2b3dd4f">例 : コイン投げの賭け</h3>
<ul>
<li>AとBの二人で交互にコインを投げる．
最初に表が出た方を勝ちとするとき，
AとBそれぞれの勝率はいくつとなるか？</li>
<li><p>
コイン投げは関数 <code>sample()</code>, <code>rbinom()</code> などを用いて模擬できる
</p>
<div class="org-src-container">

<pre><code class="R" >sample(0:1,1) # 0と1が入った壺からから1つ選ぶ
rbinom(1,size = 1,prob = 0.5) # 表裏が等確率で出る1枚のコインを1回投げる
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
確率シミュレーション
</p>
<div class="org-src-container">

<pre><code class="R" >#' コイン投げの試行 (いろいろな書き方があるので以下は一例)
my_trial &lt;- function(){
  while(TRUE){ # 永久に回るループ
    if(rbinom(1,size = 1,prob = 0.5)==1){return("A")} # Aが表で終了
    if(rbinom(1,size = 1,prob = 0.5)==1){return("B")} # Bが表で終了
    #' どちらも裏ならもう一度ループ
  }
}
#' Monte-Carlo実験
set.seed(8888) # 実験を再現したい場合はシード値を指定する
mc &lt;- 10000 # 実験回数を設定 
my_data &lt;- replicate(mc,my_trial()) 
#' 簡単な集計
table(my_data)    # 頻度
table(my_data)/mc # 確率(推定値)
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgff742a3" data-background="#fef4f4">
<h3 id="orgff742a3">練習問題</h3>
<ul>
<li>以下の簡単な双六ゲームの実験を行ってみよう
<ul>
<li>ゴールまでのます目は100</li>
<li>さいころを振り出た目の数だけ進む</li>
<li>ゴールに辿り着くまで繰り返す</li>
<li>さいころを振る回数の分布は?</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org12f0488">
<h2 id="org12f0488">参考</h2>
<div class="outline-text-2" id="text-org12f0488">
</div>
</section>
<section id="slide-org8ec7e70">
<h3 id="org8ec7e70">その他の資料</h3>
<ul>
<li>より詳細な確率シミュレーションについては以下を参照して下さい
<ul>
<li>講義ノート
<ul>
<li><p>
R言語の基礎 第5章 (pp71-82)
</p>
<ul>
<li>Buffon の針</li>
<li>Monty Hall 問題</li>
<li>秘書問題 (最適停止問題)</li>

</ul>
<p>
などの実装例がある
</p></li>

</ul></li>
<li>統計データ解析I スライド 
<ul>
<li>第5講 確率シミュレーション</li>

</ul></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgeb83be5">
<h2 id="orgeb83be5">次回の予定</h2>
<ul>
<li><b>第1回: 回帰モデルの考え方と推定</b></li>
<li>第2回: モデルの評価</li>
<li>第3回: モデルによる予測と発展的なモデル</li>

</ul>
<div class="slide-footer"><br></div>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
spotlight: { size: 90, initialPresentationMode: false }, chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }, 84: function() { RevealSpotlight.toggleSpotlight() }, 81: function() { RevealSpotlight.togglePresentationMode()}},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'},
{ src: './reveal.js/plugin/spotlight/spotlight.js'}]

});
</script>
</body>
</html>
