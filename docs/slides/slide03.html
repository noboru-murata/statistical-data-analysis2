<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>回帰分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/menu.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/drawer/drawer.css"/>

<link rel="stylesheet" href="./reveal.js/local/mycourse.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">回帰分析</h1>
</div>
<div class="talk-subtitle">
    <p>回帰モデルの考え方と推定</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>
<section>
<section id="slide-org6e00ed9">
<h2 id="org6e00ed9">講義概要</h2>
<ul>
<li><b>第1回 : 回帰モデルの考え方と推定</b></li>
<li>第2回 : モデルの評価</li>
<li>第3回 : モデルによる予測と発展的なモデル</li>

</ul>
</section>
</section>
<section>
<section id="slide-org595d593">
<h2 id="org595d593">回帰分析の考え方</h2>
<div class="outline-text-2" id="text-org595d593">
</div>
</section>
<section id="slide-org3ae8350">
<h3 id="org3ae8350">回帰分析</h3>
<ul>
<li>ある変量を別の変量で説明する関係式を構成する</li>
<li>関係式 : <b>回帰式</b> (regression equation)
<ul>
<li>説明される側 : <b>目的変数</b>, 被説明変数, 従属変数, 応答変数</li>
<li>説明する側 : <b>説明変数</b>, 独立変数, 共変量</li>

</ul></li>
<li>説明変数の数による分類
<ul>
<li>一つの場合 : <b>単回帰</b> (simple regression)</li>
<li>複数の場合 : <b>重回帰</b> (multiple regression)</li>

</ul></li>

</ul>
</section>
<section id="slide-orgdd0dc83">
<h3 id="orgdd0dc83">一般の回帰の枠組</h3>
<ul>
<li><b>説明変数</b> : \(x_1,\dotsc,x_p\) (p次元)</li>
<li><b>目的変数</b> : \(y\) (1次元)</li>
<li><p>
<b>回帰式</b> : \(y\) を \(x_1,\dotsc,x_p\) で説明するための関係式
</p>
<blockquote>
<div>
\begin{equation}
  y=f(x_1,\dotsc,x_p)
\end{equation}

</div>
</blockquote></li>
<li><p>
観測データ : n個の \((y,x_1,\dotsc,x_p)\) の組
</p>
<blockquote>
<div>
\begin{equation}
  \{(y_i,x_{i1},\dotsc,x_{ip})\}_{i=1}^n
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgb852316">
<h3 id="orgb852316">線形回帰</h3>
<ul>
<li>任意の \(f\) では一般的すぎて分析に不向き</li>
<li><p>
\(f\) として <b>1次関数</b> を考える
</p>
<blockquote>
<p>
ある定数 \(\beta_0,\beta_1,\dots,\beta_p\) を用いた式 :
</p>
<div>
\begin{equation}
  f(x_1,\dots,x_p)=\beta_0+\beta_1x_1+\cdots+\beta_px_p
\end{equation}

</div>
</blockquote>
<ul>
<li>1次関数の場合 : <b>線形回帰</b> (linear regression)</li>
<li>一般の場合 : 非線形回帰 (nonlinear regression)</li>

</ul></li>
<li>非線形関係は新たな説明変数の導入で対応可能
<ul>
<li>適切な多項式 : \(x_j^2, x_jx_k, x_jx_kx_l,\dotsc\)</li>
<li>その他の非線形変換 : \(\log x_j, x_j^\alpha,\dotsc\)</li>
<li>全ての非線形関係ではないことに注意</li>

</ul></li>

</ul>
</section>
<section id="slide-orgb3b44d1">
<h3 id="orgb3b44d1">回帰係数</h3>
<ul>
<li><p>
線形回帰式
</p>
<blockquote>
<div>
\begin{equation}
  y=\beta_0+\beta_1x_1+\cdots+\beta_px_p
\end{equation}

</div>
</blockquote>
<ul>
<li>\(\beta_0,\beta_1,\dots,\beta_p\) : <b>回帰係数</b> (regression coefficients)</li>
<li>\(\beta_0\) : <b>定数項 / 切片</b> (constant term / intersection)</li>

</ul></li>
<li>線形回帰分析 (linear regression analysis)
<ul>
<li>未知の回帰係数をデータから決定する分析方法</li>
<li>決定された回帰係数の統計的な性質を診断</li>

</ul></li>

</ul>
</section>
<section id="slide-org489334d">
<h3 id="org489334d">回帰の確率モデル</h3>
<ul>
<li>回帰式の不確定性
<ul>
<li>データは一般に観測誤差などランダムな変動を含む</li>
<li>回帰式がそのまま成立することは期待できない</li>

</ul></li>
<li><p>
確率モデル : データのばらつきを表す項 \(\epsilon_i\) を追加
</p>
<blockquote>
<div>
\begin{equation}
  y_i=\beta_0+\beta_1 x_{i1}+\cdots+\beta_px_{ip}+\epsilon_i\quad (i=1,\dots,n)
\end{equation}

</div>
</blockquote>
<ul>
<li>\(\epsilon_1,\dots,\epsilon_n\) : <b>誤差項 / 撹乱項</b> (error / disturbance term)
<ul>
<li>誤差項は独立な確率変数と仮定</li>
<li>多くの場合，平均0，分散 \(\sigma^2\) の正規分布を仮定</li>

</ul></li>

</ul></li>
<li><b>推定</b> (estimation) :
観測データから回帰係数を決定</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgfd89cf9">
<h2 id="orgfd89cf9">回帰係数の推定</h2>
<div class="outline-text-2" id="text-orgfd89cf9">
</div>
</section>
<section id="slide-orgb843855">
<h3 id="orgb843855">残差</h3>
<ul>
<li><b>残差</b> (residual) :
回帰式で説明できない変動</li>
<li><p>
回帰係数 \(\boldsymbol{\beta}=(\beta_0,\beta_1,\dotsc,\beta_p)^{\mathsf{T}}\) 
を持つ回帰式の残差
</p>
<blockquote>
<div>
\begin{equation}
  e_i(\boldsymbol{\beta})=
  y_i-(\beta_0+\beta_1 x_{i1}+\dotsb+\beta_px_{ip})
  \quad (i=1,\dotsc,n)
\end{equation}

</div>
</blockquote></li>
<li>残差 \(e_i(\boldsymbol{\beta})\) の絶対値が小さいほど当てはまりがよい</li>

</ul>
</section>
<section id="slide-orged7e61a">
<h3 id="orged7e61a">最小二乗法</h3>
<ul>
<li><p>
<b>残差平方和</b> (residual sum of squares)
</p>
<blockquote>
<div>
\begin{equation}
  S(\boldsymbol{\beta})
  =
  \sum_{i=1}^ne_i(\boldsymbol{\beta})^2
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>最小二乗推定量</b> (least squares estimator)
</p>
<blockquote>
<p>
残差平方和
\(S(\boldsymbol{\beta})\)
を最小にする
\(\boldsymbol{\beta}\)
</p>
<div>
\begin{equation}
  \boldsymbol{\hat{\beta}}
  =
  (\hat{\beta}_0,\hat{\beta}_1,\dotsc,\hat{\beta}_p)^{\mathsf{T}}
  =
  \arg\min_{\boldsymbol{\beta}}S(\boldsymbol{\beta})
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orge133d06">
<h3 id="orge133d06">行列の定義</h3>
<ul>
<li><p>
デザイン行列 (design matrix)
</p>
<blockquote>
<div>
\begin{equation}
  X=
  \begin{pmatrix}
    1 & x_{11} & x_{12} & \cdots & x_{1p} \\
    1 & x_{21} & x_{22} & \cdots & x_{2p} \\
    \vdots & \vdots & \vdots & & \vdots \\
    1 & x_{n1} & x_{n2} & \cdots & x_{np}
  \end{pmatrix}
\end{equation}

</div>
</blockquote>
<ul>
<li>\(n\times(p{+}1)\)行列</li>

</ul></li>

</ul>
</section>
<section id="slide-orgf030234">
<h3 id="orgf030234">ベクトルの定義</h3>
<ul>
<li><p>
目的変数，誤差，回帰係数のベクトル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}=
  \begin{pmatrix}
    y_1 \\
    y_2 \\
    \vdots \\
    y_n
  \end{pmatrix},\quad
  \boldsymbol{\epsilon}=
  \begin{pmatrix}
    \epsilon_1 \\
    \epsilon_2 \\
    \vdots \\
    \epsilon_n
  \end{pmatrix},\quad
  \boldsymbol{\beta}=
  \begin{pmatrix}
    \beta_0 \\
    \beta_1 \\
    \vdots \\
    \beta_p
  \end{pmatrix}
\end{equation}

</div>
</blockquote>
<ul>
<li>\(\boldsymbol{y},\boldsymbol{\epsilon}\) は\(n\)次元ベクトル</li>
<li>\(\boldsymbol{\beta}\) は\(p{+}1\)次元ベクトル</li>

</ul></li>

</ul>
</section>
<section id="slide-org0f770c1">
<h3 id="org0f770c1">行列・ベクトルによる表現</h3>
<ul>
<li><p>
確率モデル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{y}
  =X\boldsymbol{\beta}+\boldsymbol{\epsilon}
\end{equation}

</div>
</blockquote></li>
<li><p>
残差平方和
</p>
<blockquote>
<div>
\begin{equation}
  S(\boldsymbol{\beta})
  =(\boldsymbol{y}-X\boldsymbol{\beta})^{\mathsf{T}}
  (\boldsymbol{y}-X\boldsymbol{\beta})
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgd4eb89a">
<h3 id="orgd4eb89a">解の条件</h3>
<ul>
<li><p>
解 \(\boldsymbol{\beta}\) では残差平方和の勾配は零ベクトル
</p>

<blockquote>
<div>
\begin{equation}
  \nabla S(\boldsymbol{\beta})=
  \Bigl(
  \frac{\partial S}{\partial\beta_0}(\boldsymbol{\beta}),
  \frac{\partial S}{\partial\beta_1}(\boldsymbol{\beta}),\dotsc,
  \frac{\partial S}{\partial\beta_p}(\boldsymbol{\beta})
  \Bigr)^\mathsf{T}=\boldsymbol{0}
\end{equation}

</div>
</blockquote></li>
<li><p>
成分 (\(j=0,1,\dotsc,p\)) ごとの条件式
</p>
<blockquote>
<div>
\begin{equation}
  \frac{\partial S}{\partial\beta_j}(\boldsymbol{\beta})
  =
  -2\sum_{i=1}^n\Bigl(y_i-\sum_{k=0}^p\beta_kx_{ik}\Bigr)x_{ij}
  =0
\end{equation}

</div>
<p>
ただし \(x_{i0}=1\; (i=1,\dotsc,n)\)
</p>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgd2ffef0">
<h2 id="orgd2ffef0">正規方程式</h2>
<div class="outline-text-2" id="text-orgd2ffef0">
</div>
</section>
<section id="slide-orgcda9778">
<h3 id="orgcda9778">正規方程式</h3>
<ul>
<li><p>
<b>正規方程式</b> (normal equation)
</p>
<blockquote>
<div>
\begin{equation}
  X^{\mathsf{T}}X\boldsymbol{\beta}
  =X^{\mathsf{T}}\boldsymbol{y}
\end{equation}

</div>
</blockquote></li>
<li>\(X^{\mathsf{T}}X\) : <b>Gram行列</b> (Gram matrix)
<ul>
<li>\((p{+}1)\times(p{+}1)\) 行列 (正方行列)</li>
<li>正定対称行列 (固有値が非負)</li>

</ul></li>

</ul>
</section>
<section id="slide-org3808404">
<h3 id="org3808404">正規方程式の解</h3>
<ul>
<li>正規方程式の基本的な性質
<ul>
<li>正規方程式は必ず解をもつ (一意に決まらない場合もある)</li>
<li>正規方程式の解は最小二乗推定量であるための必要条件</li>

</ul></li>
<li>解の一意性の条件
<ul>
<li>Gram 行列 \(X^{\mathsf{T}}X\) が <b>正則</b></li>
<li>\(X\) の列ベクトルが独立 (後述)</li>

</ul></li>
<li><p>
正規方程式の解
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\beta}}
  =
  (X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}  
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-org3c3ad80" data-background="#fef4f4">
<h2 id="org3c3ad80">実習</h2>
</section>
<section id="slide-org460f048">
<h3 id="org460f048">R : 線形モデルの推定</h3>
<ul>
<li><p>
関数 <code>stats::lm()</code> による推定
</p>
<div class="org-src-container">

<pre class="src src-R">lm(formula, data, subset, weights, na.action,
   method = <span style="color: #d08928;">"qr"</span>, model = <span style="color: #00aa80;">TRUE</span>, x = <span style="color: #00aa80;">FALSE</span>, y = <span style="color: #00aa80;">FALSE</span>, qr = <span style="color: #00aa80;">TRUE</span>,
   singular.ok = <span style="color: #00aa80;">TRUE</span>, contrasts = <span style="color: #00aa80;">NULL</span>, offset, ...)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> formula: &#30446;&#30340;&#22793;&#25968;&#21517; ~ &#35500;&#26126;&#22793;&#25968;&#21517;(&#35079;&#25968;&#12354;&#12427;&#22580;&#21512;&#12399; + &#12391;&#20006;&#12409;&#12427;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#30446;&#30340;&#22793;&#25968;&#65292;&#35500;&#26126;&#22793;&#25968;&#12434;&#21547;&#12416;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> subset: &#25512;&#23450;&#12395;&#29992;&#12356;&#12427;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#37096;&#20998;&#38598;&#21512;&#12434;&#25351;&#23450;(&#25351;&#23450;&#12375;&#12394;&#12369;&#12428;&#12400;&#20840;&#12390;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> na.action: &#27424;&#25613;&#12398;&#25201;&#12356;&#12434;&#25351;&#23450;(&#26082;&#23450;&#20516;&#12399;option("na.action")&#12391;&#35373;&#23450;&#12373;&#12428;&#12383;&#20966;&#29702;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> model,x,y,qr: &#36820;&#20516;&#12395;model.frame,model.matrix,&#30446;&#30340;&#22793;&#25968;,QR&#20998;&#35299;&#12434;&#21547;&#12416;&#12363;&#25351;&#23450;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-orgb50ff51">
<h3 id="orgb50ff51">例 : ボルドーワインの価格と気候</h3>
<ul>
<li><p>
配布データ <code>wine.csv</code> の回帰分析
</p>
<div class="org-src-container">

<pre class="src src-R">bw_data <span style="color: #60aa00;">&lt;-</span> read_csv(file=<span style="color: #d08928;">"data/wine.csv"</span>)  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
bw_fit <span style="color: #60aa00;">&lt;-</span> lm(formula = LPRICE2 ~ . - VINT, <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">VINT&#12434;&#38500;&#12367;&#20840;&#12390;</span>
             data = bw_data) 
</pre>
</div>
<div class="org-src-container">

<pre class="src src-R">bw_fit <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25512;&#23450;&#32080;&#26524;&#12398;&#31777;&#21336;&#12394;&#34920;&#31034;</span>
</pre>
</div>

<pre class="example">

Call:
lm(formula = LPRICE2 ~ . - VINT, data = bw_data)

Coefficients:
(Intercept)        WRAIN      DEGREES        HRAIN  
 -12.145334     0.001167     0.616392    -0.003861  
    TIME_SV  
   0.023847
</pre></li>

</ul>
</section>
<section id="slide-org01b4d4f" data-background="#fef4f4">
<h3 id="org01b4d4f">練習問題</h3>
<ul>
<li><p>
データセット <code>Advertising.csv</code> は
広告費 (TV, radio, newspapers) と売上の関係を調べたものである．
このデータセットを用いて以下の回帰式を推定しなさい．
</p>
<div class="org-src-container">

<pre class="src src-R">formula = sales ~ TV 
formula = sales ~ radio
formula = sales ~ TV + radio
</pre>
</div>
<ul>
<li>URL : <a href="https://www.statlearning.com/s/Advertising.csv">https://www.statlearning.com/s/Advertising.csv</a></li>
<li><p>
データに関する記載事項 (<a href="https://www.statlearning.com">https://www.statlearning.com</a> より) 
</p>
<blockquote>
<p>
Datasets in this presentation are taken from &ldquo;An Introduction to
Statistical Learning, with applications in R&rdquo; (Springer, 2013)
with permission from the authors: G. James, D. Witten, T. Hastie
and R. Tibshirani.
</p>
</blockquote></li>

</ul></li>

</ul>
</section>
<section id="slide-orgb9cadb7" data-background="#fef4f4">
<h3 id="orgb9cadb7">練習問題</h3>
<ul>
<li><p>
データセット <code>tokyo_weather.csv</code> は
気象庁より取得した東京の気候データを回帰分析用に整理したものである．
このデータセットのうち，9月の気候データを用いて，以下の回帰式を推定しなさい．
</p>
<div class="org-src-container">

<pre class="src src-R">formula = temp ~ solar + press
</pre>
</div>
<ul>
<li>参考 : <a href="https://www.data.jma.go.jp/gmd/risk/obsdl/index.php">https://www.data.jma.go.jp/gmd/risk/obsdl/index.php</a></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgd95b4c2">
<h2 id="orgd95b4c2">最小二乗推定量の性質</h2>
<div class="outline-text-2" id="text-orgd95b4c2">
</div>
</section>
<section id="slide-org5fd355e">
<h3 id="org5fd355e">解析の上での良い条件</h3>
<ul>
<li><p>
最小二乗推定量がただ一つだけ存在する条件 
</p>
<ul>
<li>\(X^{\mathsf{T}}X\) が正則</li>
<li>\(X^{\mathsf{T}}X\) の階数が \(p{+}1\)</li>
<li>\(X\) の階数が \(p{+}1\)</li>
<li>\(X\) の列ベクトルが <b>1次独立</b></li>

</ul>
<p>
これらは同値条件
</p></li>

</ul>
</section>
<section id="slide-orgb254589">
<h3 id="orgb254589">解析の上での良くない条件</h3>
<ul>
<li>説明変数が1次従属 : <b>多重共線性</b> (multicollinearity)</li>
<li>多重共線性が強くならないように説明変数を選択
<ul>
<li>\(X\) の列(説明変数)の独立性を担保する</li>
<li>説明変数が互いに異なる情報をもつように選ぶ</li>
<li>似た性質をもつ説明変数の重複は避ける</li>

</ul></li>

</ul>
</section>
<section id="slide-org5969d6b">
<h3 id="org5969d6b">推定の幾何学的解釈</h3>
<ul>
<li><p>
<b>あてはめ値 / 予測値</b> (fitted values / predicted values)
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{y}}
  =
  X\boldsymbol{\hat{\beta}}
  =
  \hat{\beta}_{0} X_\text{第0列} + 
  \dots + \hat{\beta}_{p} X_\text{第p列}
\end{equation}

</div>
</blockquote></li>

</ul>


<div id="org434e3ab" class="figure">
<p><img src="./figs/projection.png" alt="projection.png" width="60%" />
</p>
<p><span class="figure-number">Figure 1: </span>\(n=3\) , \(p+1=2\) の場合の最小二乗法による推定</p>
</div>

</section>
<section>
<ul>
<li>最小二乗推定量 \(\boldsymbol{\hat{y}}\) の幾何学的性質
<ul>
<li>\(L[X]\) : \(X\) の列ベクトルが張る \(\mathbb{R}^n\) の線形部分空間</li>
<li>\(X\) の階数が \(p{+}1\) ならば \(L[X]\) の次元は \(p{+}1\) (解の一意性)</li>
<li>\(\boldsymbol{\hat{y}}\) は \(\boldsymbol{y}\) の \(L[X]\) への直交射影</li>
<li><p>
<b>残差</b> (residuals)
\(\boldsymbol{\hat{\epsilon}}=\boldsymbol{y}-\boldsymbol{\hat{y}}\)
はあてはめ値
\(\boldsymbol{\hat{y}}\) に直交
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\epsilon}}\cdot\boldsymbol{\hat{y}}=0
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
</section>
<section id="slide-org4ae5671">
<h3 id="org4ae5671">線形回帰式と標本平均</h3>
<ul>
<li>\(\boldsymbol{x}_i=(x_{i1},\dotsc,x_{ip})^{\mathsf{T}}\):
\(i\) 番目の観測データの説明変数</li>
<li><p>
説明変数および目的変数の標本平均
</p>
<blockquote>
<div>
\begin{align}
  \boldsymbol{\bar{x}}
  &=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_i,
  &\bar{y}
  % \overline{\boldsymbol{x}^2}&=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_i\boldsymbol{x}_i^{\mathsf{T}},&
  &=\frac{1}{n}\sum_{i=1}^ny_i,&
  % \overline{\boldsymbol{x}y}&=\frac{1}{n}\sum_{i=1}^n\boldsymbol{x}_iy_i
\end{align}

</div>
</blockquote></li>
<li><p>
\(\boldsymbol{\hat{\beta}}\) が最小二乗推定量のとき以下が成立
</p>
<blockquote>
<div>
\begin{equation}
  \bar{y}
  =
  (1,\boldsymbol{\bar{x}}^{\mathsf{T}})\boldsymbol{\hat{\beta}}
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgb13ffde" data-background="#fef4f4">
<h2 id="orgb13ffde">実習</h2>
</section>
<section id="slide-org398762c">
<h3 id="org398762c">R : 推定結果からの情報の取得</h3>
<ul>
<li><p>
関数 <code>lm()</code> の出力には様々な情報が含まれる
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> lm&#12398;&#20986;&#21147;&#12434;&#24341;&#25968;&#12392;&#12377;&#12427; base R &#12398;&#38306;&#25968;&#12398;&#20363;</span>
base::summary(lm&#12398;&#20986;&#21147;)       <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25512;&#23450;&#32080;&#26524;&#12398;&#12414;&#12392;&#12417;</span>
stats::coef(lm&#12398;&#20986;&#21147;)         <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25512;&#23450;&#12373;&#12428;&#12383;&#22238;&#24112;&#20418;&#25968;</span>
stats::fitted(lm&#12398;&#20986;&#21147;)       <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12354;&#12390;&#12399;&#12417;&#20516;</span>
stats::resid(lm&#12398;&#20986;&#21147;)        <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#27531;&#24046;</span>
stats::model.frame(lm&#12398;&#20986;&#21147;)  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">model&#12395;&#24517;&#35201;&#12394;&#22793;&#25968;&#12398;&#25277;&#20986; (&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;)</span>
stats::model.matrix(lm&#12398;&#20986;&#21147;) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12470;&#12452;&#12531;&#34892;&#21015;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org10e4ada">
<h3 id="org10e4ada">R : broom パッケージ</h3>
<ul>
<li>関数 <code>base::summary()</code> の tidyverse 版</li>
<li><p>
関数 <code>stats::lm()</code> の結果を tibble 形式で表示
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#25512;&#23450;&#32080;&#26524;&#12398; tibble &#24418;&#24335;&#12391;&#12398;&#34920;&#31034;</span>
broom::tidy(lm&#12398;&#20986;&#21147;)    <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25512;&#23450;&#32080;&#26524;&#12398;&#12414;&#12392;&#12417;&#65294;coef(summary(lm&#12398;&#20986;&#21147;)) &#12392;&#21516;&#27096;</span>
broom::glance(lm&#12398;&#20986;&#21147;)  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#35413;&#20385;&#25351;&#27161;(&#32113;&#35336;&#37327;)&#12398;&#12414;&#12392;&#12417;&#65294;&#27770;&#23450;&#20418;&#25968;&#12420;F&#20516;&#12394;&#12393;&#12434;&#25972;&#29702;</span>
broom::augment(lm&#12398;&#20986;&#21147;) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20837;&#20986;&#21147;&#12487;&#12540;&#12479;&#12398;&#12414;&#12392;&#12417;&#65294;&#12354;&#12390;&#12399;&#12417;&#20516;&#12539;&#27531;&#24046;&#12394;&#12393;&#12434;&#25972;&#29702;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org7c25fb8">
<h3 id="org7c25fb8">R : 行列とベクトル</h3>
<ul>
<li>データフレーム以外の重要なデータ構造
<ul>
<li>ベクトル (vector) : 1次元の配列</li>
<li>行列 (matrix) : 2次元の同じデータ型の配列</li>

</ul></li>
<li><p>
必要であれば明示的に変換できる
</p>
<div class="org-src-container">

<pre class="src src-R">as.vector(&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;[&#21015;&#21517;]) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">base::as.vector()</span>
as_vector(&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;[&#21015;&#21517;]) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">purrr::as_vector()</span>
as.matrix(&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">base::as.matrix()</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12434;&#34892;&#21015;&#12395;&#22793;&#25563;&#12377;&#12427;&#22580;&#21512;&#12399;&#20840;&#12390;&#21516;&#12376;&#12487;&#12540;&#12479;&#22411;&#12391;&#12394;&#12367;&#12390;&#12399;&#12394;&#12425;&#12394;&#12356;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org9d94dc4">
<h3 id="org9d94dc4">R : 行列とベクトルの計算</h3>
<ul>
<li><p>
行列 \(A,B\) の積 \(AB\) および
ベクトル \(a,b\) の内積 \(a\cdot b\)
</p>
<div class="org-src-container">

<pre class="src src-R">A <span style="color: #60aa00;">%*%</span> B <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#34892;&#21015;&#12398;&#22823;&#12365;&#12373;&#12399;&#36969;&#20999;&#12391;&#12354;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;</span>
a <span style="color: #60aa00;">%*%</span> b <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12505;&#12463;&#12488;&#12523;&#12399;&#21516;&#12376;&#38263;&#12373;&#12391;&#12354;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;</span>
</pre>
</div></li>
<li><p>
正方行列 \(A\) の逆行列 \(A^{-1}\)
</p>
<div class="org-src-container">

<pre class="src src-R">solve(A) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20182;&#12395;&#12418;&#12356;&#12367;&#12388;&#12363;&#38306;&#25968;&#12399;&#12354;&#12427;</span>
</pre>
</div></li>
<li><p>
\(X^{\mathsf{T}}Y\) および \(X^{\mathsf{T}}X\) の計算
</p>
<div class="org-src-container">

<pre class="src src-R">crossprod(X, Y) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">cross product &#12398;&#30053;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> X: &#34892;&#21015; (&#12414;&#12383;&#12399;&#12505;&#12463;&#12488;&#12523;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> Y: &#34892;&#21015; (&#12414;&#12383;&#12399;&#12505;&#12463;&#12488;&#12523;)</span>
crossprod(X) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#12376;&#12418;&#12398;&#12434;&#25499;&#12369;&#12427;&#22580;&#21512;&#12399;&#24341;&#25968;&#12399;1&#12388;&#12391;&#33391;&#12356;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-orge21d613" data-background="#fef4f4">
<h3 id="orge21d613">練習問題</h3>
<ul>
<li>前問の推定結果を用いて
最小二乗推定量の性質を確認しなさい
<ul>
<li><p>
推定された係数が正規方程式の解
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\beta}}
  =
  (X^{\mathsf{T}}X)^{-1}X^{\mathsf{T}}\boldsymbol{y}  
\end{equation}

</div>
</blockquote>
<p>
となること
</p></li>
<li>あてはめ値と残差が直交すること</li>
<li>回帰式が標本平均を通ること</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org5e13bf7">
<h2 id="org5e13bf7">残差の分解</h2>
<div class="outline-text-2" id="text-org5e13bf7">
</div>
</section>
<section id="slide-org96954d6">
<h3 id="org96954d6">最小二乗推定量の残差</h3>
<ul>
<li><p>
観測値と推定値 \(\boldsymbol{\hat{\beta}}\) による予測値の差
</p>
<blockquote>
<div>
\begin{equation}
  \hat{\epsilon}_i=
  y_i-(\hat{\beta}_0+\hat{\beta}_1 x_{i1}+\dotsb+\hat{\beta}_px_{ip})
  \quad (i=1,\dotsc,n)
\end{equation}

</div>
</blockquote>
<ul>
<li>誤差項 \(\epsilon_1,\dotsc,\epsilon_n\) の推定値</li>
<li>全てができるだけ小さいほど良い</li>
<li>予測値とは独立に偏りがないほど良い</li>

</ul></li>
<li><p>
残差ベクトル
</p>
<blockquote>
<div>
\begin{equation}
  \boldsymbol{\hat{\epsilon}}
  =\boldsymbol{y}-\boldsymbol{\hat{y}}
  =(\hat{\epsilon}_1,\hat{\epsilon}_2,\dotsc,\hat{\epsilon}_n)^{\mathsf{T}}
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-org3cb8166">
<h3 id="org3cb8166">平方和の分解</h3>
<ul>
<li>\(\bar{\boldsymbol{y}}=\bar{y}\boldsymbol{1}=(\bar{y},\bar{y},\dotsc,\bar{y})^{\mathsf{T}}\) :
標本平均のベクトル</li>
<li>いろいろなばらつき
<ul>
<li>\(S_y=(\boldsymbol{y}-\bar{\boldsymbol{y}})^{\mathsf{T}}
    (\boldsymbol{y}-\bar{\boldsymbol{y}})\) :
目的変数のばらつき</li>
<li>\(S_{\phantom{y}}=(\boldsymbol{y}-\boldsymbol{\hat{y}})^{\mathsf{T}}
    (\boldsymbol{y}-\boldsymbol{\hat{y}})\) :
残差のばらつき
(\(\boldsymbol{\hat{\epsilon}}^{\mathsf{T}}\boldsymbol{\hat{\epsilon}}\))</li>
<li>\(S_r=(\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
    (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})\) :
あてはめ値(回帰)のばらつき</li>

</ul></li>
<li><p>
3つのばらつき(平方和)の関係
</p>
<blockquote>
<div>
\begin{equation}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})
  =
  (\boldsymbol{y}-\boldsymbol{\hat{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})+ 
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})
\end{equation}

</div>
<div>
\begin{equation}
  S_y=S+S_r
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgabcdfea" data-background="#fef4f4">
<h2 id="orgabcdfea">実習</h2>
</section>
<section id="slide-org1de2661" data-background="#fef4f4">
<h3 id="org1de2661">練習問題</h3>
<ul>
<li>前問の結果を用いて
残差の性質を確認しなさい
<ul>
<li><p>
以下の分解が成り立つこと
</p>
<blockquote>
<div>
\begin{equation}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\bar{\boldsymbol{y}})
  =
  (\boldsymbol{y}-\boldsymbol{\hat{y}})^{\mathsf{T}}
  (\boldsymbol{y}-\boldsymbol{\hat{y}})+ 
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})^{\mathsf{T}}
  (\boldsymbol{\hat{y}}-\bar{\boldsymbol{y}})
\end{equation}

</div>
<div>
\begin{equation}
  S_y=S+S_r
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgfb261b3">
<h2 id="orgfb261b3">決定係数</h2>
<div class="outline-text-2" id="text-orgfb261b3">
</div>
</section>
<section id="slide-org217321d">
<h3 id="org217321d">回帰式の寄与</h3>
<ul>
<li><p>
ばらつきの分解
</p>
<blockquote>
<div>
\begin{equation}
  S_y\;\text{(目的変数)} =S\;\text{(残差)} +S_r\;\text{(あてはめ値)}
\end{equation}

</div>
</blockquote></li>
<li><p>
回帰式で説明できるばらつきの比率
</p>
<blockquote>
<div>
\begin{equation}
  \text{(回帰式の寄与率)}
  = \frac{S_{r}}{S_{y}}
  = 1-\frac{S}{S_{y}}
\end{equation}

</div>
</blockquote></li>
<li>回帰式のあてはまり具合を評価する代表的な指標</li>

</ul>
</section>
<section id="slide-org021e248">
<h3 id="org021e248">決定係数 (\(R^2\)値)</h3>
<ul>
<li><p>
<b>決定係数</b> (R-squared)
</p>
<blockquote>
<div>
\begin{equation}
  R^2
  =
  1-\frac{\sum_{i=1}^n\hat{\epsilon}_i^2}{\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>
</blockquote></li>
<li><p>
<b>自由度調整済み決定係数</b> (adjusted R-squared)
</p>
<blockquote>
<div>
\begin{equation}
  \bar{R}^2
  =
  1-\frac{\frac{1}{n{-}p{-}1}\sum_{i=1}^n\hat{\epsilon}_i^2}
  {\frac{1}{n{-}1}\sum_{i=1}^n(y_i-\bar{y})^2}
\end{equation}

</div>
</blockquote>
<ul>
<li>不偏分散で補正している</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org51e7d6d" data-background="#fef4f4">
<h2 id="org51e7d6d">実習</h2>
</section>
<section id="slide-org7ce5f0e" data-background="#fef4f4">
<h3 id="org7ce5f0e">練習問題</h3>
<ul>
<li>決定係数を用いてモデルの比較を行いなさい
<ul>
<li><p>
広告費と売上データ
</p>
<div class="org-src-container">

<pre class="src src-R">sales ~ TV
sales ~ radio
sales ~ TV + radio
</pre>
</div></li>
<li><p>
東京の9月の気候データ
</p>
<div class="org-src-container">

<pre class="src src-R">temp ~ solar
temp ~ solar + press
temp ~ solar + press + cloud
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgb8db509">
<h2 id="orgb8db509">次回の予定</h2>
<ul>
<li>第1回 : 回帰モデルの考え方と推定</li>
<li><b>第2回 : モデルの評価</b></li>
<li>第3回 : モデルによる予測と発展的なモデル</li>

</ul>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/menu/menu.js"></script>
<script src="./reveal.js/plugin/spotlight/spotlight.js"></script>
<script src="./reveal.js/plugin/drawer/drawer.js"></script>
<script src="./reveal.js/dist/theme/hidelinks.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: true,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
showNotes: window.location.search.match( /print-pdf/gi ) ? 'separate-page' : false,
spotlight: { size: 80, initialPresentationMode: false, }, drawer: { toggleDrawKey: "d", toggleBoardKey: "c", pathSize: 3, }, keyboard: { 81: function() { RevealSpotlight.toggleSpotlight()}, 87: function() { RevealSpotlight.togglePresentationMode();}, },

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealMenu, RevealSpotlight, RevealDrawer ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
