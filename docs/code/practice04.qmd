---
title: "第4講 練習問題"
subtitle: "統計データ解析"
date: "`r Sys.Date()`"
format:
    html: 
      toc: true
      html-math-method: katex
      self-contained: true
      grid: 
        margin-width: 350px
execute: 
  echo: true
  warning: false
reference-location: margin
citation-location: margin
tbl-cap-location: margin
fig-cap-location: margin
editor: visual
---

## 準備

以下で利用する共通パッケージを読み込む．

```{r}
library(conflicted) # 関数名の衝突を警告
conflicts_prefer(   # 優先的に使う関数を指定
    dplyr::filter(),
    dplyr::select(),
    dplyr::lag(),
    )
library(tidyverse)  
library(broom)      # 解析結果を tibble 形式に集約
library(gt)         # 表の作成
library(gtsummary)  # 分析結果の表の作成
```

## 推定量の性質を調べる数値実験

::: callout-note
### 正規乱数を用いた線形単回帰モデル

以下に人工データによる推定量の性質の確認の例を示す．

```{r}
#| eval: false
set.seed(987) # 乱数のシード値を設定
x_obs <- tibble(x0 = 1, x1 = c(1,3,5,7)) # 説明変数の観測値
epsilon <- rnorm(nrow(x_obs), sd = 0.5) # 誤差項の生成
beta <- c(2, -3) # 回帰係数
toy_data <- x_obs |> # 目的変数の観測値を追加
    mutate(y = as.vector(as.matrix(x_obs) %*% beta) + epsilon)
toy_lm <- lm(y ~ x1, data = toy_data) # 回帰係数の推定
coef(toy_lm) # 回帰係数の取得
summary(toy_lm) # 分析結果の概要の表示
```

上記の例では行列とベクトルの積を用いているが， 以下のように説明変数・目的変数を個別に作成してもよい．

```{r}
#| eval: false
x_obs <- c(1,3,5,7) # 説明変数の観測値
epsilon <- rnorm(length(x_obs), sd = 0.5) # 誤差項の生成
y_obs <- 2 - 3 * x_obs + epsilon # 目的変数の観測値
toy_data <- tibble(x1 = x_obs, y = y_obs) # データフレームの作成
```
:::

::: callout-note
### 数値実験 (Monte-Carlo法)

実験のためのコードは以下のようになる.

```{r}
#| eval: false
mc_num <- 5000 # 実験回数を指定
mc_trial <- function() { # 1回の試行を行うプログラム
	   ## 乱数生成と推定の処理
	   return(返り値)} 
mc_data <- 
replicate(mc_num, mc_trial()) |> # Monte-Carlo実験
t() |> as_tibble() # 転置(関数t())してデータフレームに変換
#' 適切な統計・視覚化処理 (下記は例)
mc_data |>
      summarise(across(everything(), var)) # 各列の分散の計算
    ggpairs(mc_data) # 散布図行列の描画
    tibble(x = mc_data[[k]]) |> # k列目のベクトルで新しいデータフレームを作成
      ggplot(aes(x = x)) + geom_histogram() # k列目のデータのヒストグラム
```
:::

### 問題

最小二乗推定量の性質を数値実験 (Monte-Carlo法) により確認しなさい．

-   以下のモデルに従う人工データを生成する．
    -   説明変数の観測データ : $$
        \begin{equation}
          \{1, 20, 13, 9, 5, 15, 19, 8, 3, 4\}
        \end{equation}
        $$
    -   確率モデル : $$
        \begin{equation}
          y=-1+2\times x + \epsilon,
          \quad \epsilon\sim\mathcal{N}(0,2)
        \end{equation}
        $$
-   観測データから回帰係数を推定する．
-   実験を複数回繰り返し，推定値 ($\hat\beta_{0},\hat\beta_{1}$) の分布を調べる．

```{r}

```

## 標準誤差の性質

### 問題

数値実験により標準誤差の性質を確認しなさい．

-   人工データを用いて標準誤差と真の誤差を比較する． 標準誤差は以下のようにして取り出せる．

    ```{r}
    #| eval: false
    toy_lm <- lm(formula, toy_data)
    summary(toy_lm)$coefficients        # 係数に関する情報はリストの要素として保管されている
    summary(toy_lm)$coefficients[,2]    # 列番号での指定
    summary(toy_lm)$coef[,"Std. Error"] # 列名での指定．coef と省略してもよい
    tidy(toy_lm) # 関数 broom::tidy() でも同様に取得できる
    ```

-   広告費と売上データを用いて係数の精度を議論する．

-   東京の気候データを用いて係数の精度を議論する．

```{r}

```

## $t$ 統計量の性質

### 問題

数値実験により $t$ 統計量の性質を確認しなさい．

-   人工データを用いて $t$ 統計量の分布を確認する．

    $t$ 統計量とそのp値は以下のようにして取り出せる．

    ```{r}
    #| eval: false
    toy_lm <- lm(formula, toy_data)
    summary(toy_lm)$coef[,c("t value","Pr(>|t|)")] # 列名での指定
    summary(toy_lm)$coef[,3:4]                     # 列番号での指定
    tidy(toy_lm) # 関数 broom::tidy() を用いてもよい
    ```

-   広告費と売上データを用いて係数の有意性を議論する．

-   東京の気候データを用いて係数の有意性を議論する．

```{r}

```

## $F$ 統計量の性質

### 問題

数値実験により $F$ 統計量の性質を確認しなさい．

-   人工データを用いて $F$ 統計量の分布を確認しなさい．

    $F$ 統計量とその自由度は以下のようにして取り出せる．

    ```{r}
    #| eval: false
    toy_lm <- lm(formula, toy_data)
    summary(toy_lm)$fstat
    summary(toy_lm)$fstatistic # 省略しない場合
    glance(toy_lm) # 関数 broom::glance() を用いてもよい
    ```

-   広告費と売上データのモデルの有効性を議論しなさい．

-   東京の気候データのモデルの有効性を議論しなさい．

```{r}

```
